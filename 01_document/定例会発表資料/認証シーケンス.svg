<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2986px" preserveAspectRatio="none" style="width:1273px;height:2986px;" version="1.1" viewBox="0 0 1273 2986" width="1273px" zoomAndPan="magnify"><defs><filter height="300%" id="f15hrlzj7738s9" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="177" x="543.75" y="22.9951">認証シーケンス(永井作成)</text><rect fill="#ACB9CA" height="2940.7734" style="stroke: #A80036; stroke-width: 1.0;" width="358.5" x="301" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="431.25" y="46.3638">フロントエンド</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="112" x="424.25" y="61.4966">アプリケーション</text><rect fill="#B4C6E7" height="2940.7734" style="stroke: #A80036; stroke-width: 1.0;" width="364" x="788.5" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="84" x="928.5" y="46.3638">バックエンド</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="112" x="914.5" y="61.4966">アプリケーション</text><rect fill="#FFE699" height="2940.7734" style="stroke: #A80036; stroke-width: 1.0;" width="90" x="1154.5" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="84" x="1157.5" y="46.3638">データベース</text><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="666.4609" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="47" y="126.5938"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="360.3281" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="47" y="877.3203"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="360.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="47" y="1368.3125"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="594.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="47" y="1832.9766"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="319" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="47" y="2551.6406"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="666.4609" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="328" y="126.5938"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="360.3281" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="328" y="877.3203"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="360.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="328" y="1368.3125"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="594.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="328" y="1832.9766"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="319" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="328" y="2551.6406"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="595.1953" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="609" y="126.5938"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="267.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="609" y="969.7188"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="268.8672" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="609" y="1368.3125"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="488.6016" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="609" y="1938.5078"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="233.7344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="609" y="2565.7734"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="566.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="867" y="126.5938"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="867" y="1207.6484"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="447.0352" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="867" y="1980.0742"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="168.6016" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="867" y="2609.7734"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="95.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1091" y="2021.7734"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1194.5" y="308.2578"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1194.5" y="2146.3047"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="46.2656" style="stroke: #000000; stroke-width: 2.0;" width="399" x="562.5" y="233.9922"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="406.5313" style="stroke: #000000; stroke-width: 2.0;" width="938.5" x="23" y="394.6563"/><rect fill="#FFFFFF" height="144.3359" style="stroke: none; stroke-width: 1.0;" width="938.5" x="23" y="656.8516"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="117.5313" style="stroke: #000000; stroke-width: 2.0;" width="642.5" x="23" y="1042.1172"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="368.3984" style="stroke: #000000; stroke-width: 2.0;" width="786" x="13" y="1388.4453"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="56.2656" style="stroke: #000000; stroke-width: 2.0;" width="602" x="23" y="1538.1094"/><rect fill="#FFFFFF" height="155.4688" style="stroke: none; stroke-width: 1.0;" width="786" x="13" y="1601.375"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="443.6016" style="stroke: #000000; stroke-width: 2.0;" width="1238.5" x="13" y="2036.9063"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="151.6016" style="stroke: #000000; stroke-width: 2.0;" width="1218.5" x="23" y="2190.5703"/><rect fill="#FFFFFF" height="89.2031" style="stroke: none; stroke-width: 1.0;" width="1218.5" x="23" y="2252.9688"/><rect fill="#FFFFFF" height="131.3359" style="stroke: none; stroke-width: 1.0;" width="1238.5" x="13" y="2349.1719"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="161.4688" style="stroke: #000000; stroke-width: 2.0;" width="679" x="295" y="2625.0391"/><rect fill="#FFFFFF" height="43.9375" style="stroke: none; stroke-width: 1.0;" width="679" x="295" y="2742.5703"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="52" x2="52" y1="116.5938" y2="2888.7734"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="333" x2="333" y1="116.5938" y2="2888.7734"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="613.5" x2="613.5" y1="116.5938" y2="2888.7734"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="871.5" x2="871.5" y1="116.5938" y2="2888.7734"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1095.5" x2="1095.5" y1="116.5938" y2="2888.7734"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1199.5" x2="1199.5" y1="116.5938" y2="2888.7734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="33" y="113.292">User</text><ellipse cx="52" cy="43.2969" fill="#FEFECE" filter="url(#f15hrlzj7738s9)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M52,51.2969 L52,78.2969 M39,59.2969 L65,59.2969 M52,78.2969 L39,93.2969 M52,78.2969 L65,93.2969 " fill="#FEFECE" filter="url(#f15hrlzj7738s9)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="33" y="2900.7686">User</text><ellipse cx="52" cy="2914.0703" fill="#FEFECE" filter="url(#f15hrlzj7738s9)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M52,2922.0703 L52,2949.0703 M39,2930.0703 L65,2930.0703 M52,2949.0703 L39,2964.0703 M52,2949.0703 L65,2964.0703 " fill="#FEFECE" filter="url(#f15hrlzj7738s9)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f15hrlzj7738s9)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="52" x="305" y="81.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="312" y="101.292">HTML</text><rect fill="#FEFECE" filter="url(#f15hrlzj7738s9)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="52" x="305" y="2887.7734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="312" y="2907.7686">HTML</text><rect fill="#FEFECE" filter="url(#f15hrlzj7738s9)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="79" x="572.5" y="81.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="579.5" y="101.292">JavaScript</text><rect fill="#FEFECE" filter="url(#f15hrlzj7738s9)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="79" x="572.5" y="2887.7734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="579.5" y="2907.7686">JavaScript</text><rect fill="#FEFECE" filter="url(#f15hrlzj7738s9)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="155" x="792.5" y="81.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="141" x="799.5" y="101.292">IdentityManagement</text><rect fill="#FEFECE" filter="url(#f15hrlzj7738s9)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="155" x="792.5" y="2887.7734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="141" x="799.5" y="2907.7686">IdentityManagement</text><rect fill="#FEFECE" filter="url(#f15hrlzj7738s9)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="101" x="1043.5" y="81.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="87" x="1050.5" y="101.292">PythonScript</text><rect fill="#FEFECE" filter="url(#f15hrlzj7738s9)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="101" x="1043.5" y="2887.7734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="87" x="1050.5" y="2907.7686">PythonScript</text><rect fill="#FEFECE" filter="url(#f15hrlzj7738s9)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="60" x="1167.5" y="81.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="1174.5" y="101.292">MySQL</text><rect fill="#FEFECE" filter="url(#f15hrlzj7738s9)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="60" x="1167.5" y="2887.7734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="1174.5" y="2907.7686">MySQL</text><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="666.4609" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="47" y="126.5938"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="360.3281" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="47" y="877.3203"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="360.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="47" y="1368.3125"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="594.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="47" y="1832.9766"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="319" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="47" y="2551.6406"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="666.4609" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="328" y="126.5938"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="360.3281" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="328" y="877.3203"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="360.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="328" y="1368.3125"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="594.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="328" y="1832.9766"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="319" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="328" y="2551.6406"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="595.1953" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="609" y="126.5938"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="267.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="609" y="969.7188"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="268.8672" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="609" y="1368.3125"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="488.6016" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="609" y="1938.5078"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="233.7344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="609" y="2565.7734"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="566.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="867" y="126.5938"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="867" y="1207.6484"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="447.0352" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="867" y="1980.0742"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="168.6016" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="867" y="2609.7734"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="95.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1091" y="2021.7734"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1194.5" y="308.2578"/><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1194.5" y="2146.3047"/><rect fill="#EEEEEE" filter="url(#f15hrlzj7738s9)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1258.5" x="3" y="147.1602"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1261.5" y1="147.1602" y2="147.1602"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1261.5" y1="150.1602" y2="150.1602"/><rect fill="#EEEEEE" filter="url(#f15hrlzj7738s9)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="346" x="459.25" y="136.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="327" x="465.25" y="152.6606">ログイン/スマートカードログイン共通シーケンス図</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="877" x2="919" y1="205.9922" y2="205.9922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="919" x2="919" y1="205.9922" y2="218.9922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="878" x2="919" y1="218.9922" y2="218.9922"/><polygon fill="#A80036" points="888,214.9922,878,218.9922,888,222.9922,884,218.9922" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="884" y="185.7935">ユーザー名/パスワード</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="884" y="200.9263">バリデーション</text><rect fill="none" height="46.2656" style="stroke: #000000; stroke-width: 2.0;" width="399" x="562.5" y="233.9922"/><polygon fill="#EEEEEE" points="562.5,233.9922,632.5,233.9922,632.5,240.9922,622.5,250.9922,562.5,250.9922,562.5,233.9922" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="577.5" y="247.0591">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="647.5" y="246.2026">[バリデーション失敗]</text><polygon fill="#A80036" points="630,268.125,620,272.125,630,276.125,626,272.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="624" x2="866" y1="272.125" y2="272.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="636" y="267.1919">失敗応答(401)</text><polygon fill="#A80036" points="1182.5,304.2578,1192.5,308.2578,1182.5,312.2578,1186.5,308.2578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="877" x2="1188.5" y1="308.2578" y2="308.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="884" y="303.3247">ユーザー情報取得問合せ</text><polygon fill="#A80036" points="888,333.3906,878,337.3906,888,341.3906,884,337.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="882" x2="1198.5" y1="337.3906" y2="337.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="894" y="332.4575">ユーザー情報</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="877" x2="919" y1="366.6563" y2="366.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="919" x2="919" y1="366.6563" y2="379.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="878" x2="919" y1="379.6563" y2="379.6563"/><polygon fill="#A80036" points="888,375.6563,878,379.6563,888,383.6563,884,379.6563" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="26" x="884" y="361.5903">認証</text><rect fill="none" height="406.5313" style="stroke: #000000; stroke-width: 2.0;" width="938.5" x="23" y="394.6563"/><polygon fill="#EEEEEE" points="23,394.6563,87,394.6563,87,401.6563,77,411.6563,23,411.6563,23,394.6563" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="38" y="407.7231">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58" x="102" y="406.8667">[認証成功]</text><polygon fill="#A80036" points="349,443.7891,339,447.7891,349,451.7891,345,447.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="343" x2="866" y1="447.7891" y2="447.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="355" y="427.856">CSRF(クロスサイトリクエストフォージェリ)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="355" y="442.9888">対策のトークンをブラウザのCookieに書き込む</text><polygon fill="#A80036" points="630,473.0547,620,477.0547,630,481.0547,626,477.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="624" x2="866" y1="477.0547" y2="477.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="636" y="472.1216">ログイン処理応答(ユーザー情報, 201)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="619" x2="661" y1="506.3203" y2="506.3203"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="661" x2="661" y1="506.3203" y2="519.3203"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="620" x2="661" y1="519.3203" y2="519.3203"/><polygon fill="#A80036" points="630,515.3203,620,519.3203,630,523.3203,626,519.3203" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="626" y="501.2544">ユーザー情報保持</text><polygon fill="#A80036" points="349,544.3203,339,548.3203,349,552.3203,345,548.3203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="343" x2="608" y1="548.3203" y2="548.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="355" y="543.3872">ユーザー情報</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="619" x2="661" y1="577.5859" y2="577.5859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="661" x2="661" y1="577.5859" y2="590.5859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="620" x2="661" y1="590.5859" y2="590.5859"/><polygon fill="#A80036" points="630,586.5859,620,590.5859,630,594.5859,626,590.5859" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="626" y="572.52">共通画面遷移</text><polygon fill="#A80036" points="349,615.5859,339,619.5859,349,623.5859,345,619.5859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="343" x2="608" y1="619.5859" y2="619.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="355" y="614.6528">共通画面表示</text><polygon fill="#A80036" points="68,644.7188,58,648.7188,68,652.7188,64,648.7188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="62" x2="327" y1="648.7188" y2="648.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="74" y="643.7856">共通画面表示</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="961.5" y1="657.8516" y2="657.8516"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58" x="28" y="668.062">[認証失敗]</text><polygon fill="#A80036" points="630,688.6563,620,692.6563,630,696.6563,626,692.6563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="624" x2="871" y1="692.6563" y2="692.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="636" y="687.7231">ログイン処理応答(401)</text><polygon fill="#A80036" points="349,717.7891,339,721.7891,349,725.7891,345,721.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="343" x2="613" y1="721.7891" y2="721.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="355" y="716.856">エラーメッセージ</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="338" x2="380" y1="751.0547" y2="751.0547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="380" x2="380" y1="751.0547" y2="764.0547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="339" x2="380" y1="764.0547" y2="764.0547"/><polygon fill="#A80036" points="349,760.0547,339,764.0547,349,768.0547,345,764.0547" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="345" y="745.9888">エラーメッセージ表示</text><polygon fill="#A80036" points="63,789.0547,53,793.0547,63,797.0547,59,793.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57" x2="332" y1="793.0547" y2="793.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="69" y="788.1216">ログイン失敗</text><rect fill="#EEEEEE" filter="url(#f15hrlzj7738s9)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1258.5" x="3" y="828.7539"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1261.5" y1="828.7539" y2="828.7539"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1261.5" y1="831.7539" y2="831.7539"/><rect fill="#EEEEEE" filter="url(#f15hrlzj7738s9)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="75" x="594.75" y="818.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56" x="600.75" y="834.2544">ログイン</text><polygon fill="#A80036" points="316,873.3203,326,877.3203,316,881.3203,320,877.3203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="57" x2="322" y1="877.3203" y2="877.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="64" y="872.3872">ユーザー名入力</text><polygon fill="#FBFB77" filter="url(#f15hrlzj7738s9)" points="343,856.3203,343,881.3203,481,881.3203,481,866.3203,471,856.3203,343,856.3203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="471" x2="471" y1="856.3203" y2="866.3203"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="481" x2="471" y1="866.3203" y2="866.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="349" y="873.3872">初期画面は認証画面</text><polygon fill="#A80036" points="316,907.4531,326,911.4531,316,915.4531,320,911.4531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="57" x2="322" y1="911.4531" y2="911.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="64" y="906.52">パスワード入力</text><polygon fill="#A80036" points="316,936.5859,326,940.5859,316,944.5859,320,940.5859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="57" x2="322" y1="940.5859" y2="940.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="64" y="935.6528">ログインボタン押下</text><polygon fill="#A80036" points="597,965.7188,607,969.7188,597,973.7188,601,969.7188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="338" x2="603" y1="969.7188" y2="969.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="345" y="964.7856">ユーザー名/パスワード</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="619" x2="661" y1="1014.1172" y2="1014.1172"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="661" x2="661" y1="1014.1172" y2="1027.1172"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="620" x2="661" y1="1027.1172" y2="1027.1172"/><polygon fill="#A80036" points="630,1023.1172,620,1027.1172,630,1031.1172,626,1027.1172" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="626" y="993.9185">ユーザー名/パスワード</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="626" y="1009.0513">バリデーション</text><rect fill="none" height="117.5313" style="stroke: #000000; stroke-width: 2.0;" width="642.5" x="23" y="1042.1172"/><polygon fill="#EEEEEE" points="23,1042.1172,93,1042.1172,93,1049.1172,83,1059.1172,23,1059.1172,23,1042.1172" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="38" y="1055.1841">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="108" y="1054.3276">[バリデーション失敗]</text><polygon fill="#A80036" points="349,1076.25,339,1080.25,349,1084.25,345,1080.25" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="343" x2="608" y1="1080.25" y2="1080.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="355" y="1075.3169">エラーメッセージ</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="338" x2="380" y1="1109.5156" y2="1109.5156"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="380" x2="380" y1="1109.5156" y2="1122.5156"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="339" x2="380" y1="1122.5156" y2="1122.5156"/><polygon fill="#A80036" points="349,1118.5156,339,1122.5156,349,1126.5156,345,1122.5156" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="345" y="1104.4497">エラーメッセージ表示</text><polygon fill="#A80036" points="68,1147.5156,58,1151.5156,68,1155.5156,64,1151.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="62" x2="327" y1="1151.5156" y2="1151.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="74" y="1146.5825">ログイン失敗</text><polygon fill="#A80036" points="855,1203.6484,865,1207.6484,855,1211.6484,859,1207.6484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="619" x2="861" y1="1207.6484" y2="1207.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="626" y="1187.7153">ログイン処理要求</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="626" y="1202.8481">(ユーザー名/パスワード)</text><polygon fill="#FBFB77" filter="url(#f15hrlzj7738s9)" points="882,1171.6484,882,1211.6484,1001,1211.6484,1001,1181.6484,991,1171.6484,882,1171.6484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="991" x2="991" y1="1171.6484" y2="1181.6484"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1001" x2="991" y1="1181.6484" y2="1181.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="888" y="1188.7153">Method: POST</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="888" y="1203.8481">Endpoint: /login</text><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="40.2656" style="stroke: #000000; stroke-width: 2.0;" width="1200.5" x="30" y="1250.9141"/><polygon fill="#EEEEEE" points="30,1250.9141,96,1250.9141,96,1257.9141,86,1267.9141,30,1267.9141,30,1250.9141" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="43" y="1264.981">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="480.75" y="1283.981">ログイン/スマートカードログイン共通シーケンス図</text><rect fill="#EEEEEE" filter="url(#f15hrlzj7738s9)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1258.5" x="3" y="1316.7461"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1261.5" y1="1316.7461" y2="1316.7461"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1261.5" y1="1319.7461" y2="1319.7461"/><rect fill="#EEEEEE" filter="url(#f15hrlzj7738s9)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="201" x="531.75" y="1306.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="182" x="537.75" y="1322.2466">スマートカード読み取り失敗</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="614" x2="661" y1="1355.4453" y2="1355.4453"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="661" x2="661" y1="1355.4453" y2="1368.4453"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="620" x2="661" y1="1368.4453" y2="1368.4453"/><polygon fill="#A80036" points="630,1364.4453,620,1368.4453,630,1372.4453,626,1368.4453" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="626" y="1350.3794">失敗原因確認</text><polygon fill="#FBFB77" filter="url(#f15hrlzj7738s9)" points="716,1345.8125,716,1370.8125,990,1370.8125,990,1355.8125,980,1345.8125,716,1345.8125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="980" x2="980" y1="1345.8125" y2="1355.8125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="990" x2="980" y1="1355.8125" y2="1355.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="253" x="722" y="1362.8794">バックエンドからの応答のBodyで判断する</text><rect fill="none" height="368.3984" style="stroke: #000000; stroke-width: 2.0;" width="786" x="13" y="1388.4453"/><polygon fill="#EEEEEE" points="13,1388.4453,77,1388.4453,77,1395.4453,67,1405.4453,13,1405.4453,13,1388.4453" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="28" y="1401.5122">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="354" x="92" y="1400.6558">[ユーザーが3秒以内にスマートカードをカードリーダに載せない]</text><polygon fill="#A80036" points="349,1422.5781,339,1426.5781,349,1430.5781,345,1426.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="343" x2="608" y1="1426.5781" y2="1426.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="355" y="1421.645">エラーメッセージおよび再実行ボタン表示</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="338" x2="380" y1="1455.8438" y2="1455.8438"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="380" x2="380" y1="1455.8438" y2="1468.8438"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="339" x2="380" y1="1468.8438" y2="1468.8438"/><polygon fill="#A80036" points="349,1464.8438,339,1468.8438,349,1472.8438,345,1468.8438" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="345" y="1450.7778">画面更新</text><polygon fill="#A80036" points="68,1506.4102,58,1510.4102,68,1514.4102,64,1510.4102" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="62" x2="327" y1="1510.4102" y2="1510.4102"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="74" y="1505.4771">エラーメッセージおよび再実行ボタン表示</text><polygon fill="#FBFB77" filter="url(#f15hrlzj7738s9)" points="343,1481.8438,343,1521.8438,611,1521.8438,611,1491.8438,601,1481.8438,343,1481.8438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="601" x2="601" y1="1481.8438" y2="1491.8438"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="611" x2="601" y1="1491.8438" y2="1491.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="349" y="1498.9106">スマートカード読み取りに失敗しました。</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="349" y="1514.0435">再度スマートカード読み取りしますか?</text><rect fill="none" height="56.2656" style="stroke: #000000; stroke-width: 2.0;" width="602" x="23" y="1538.1094"/><polygon fill="#EEEEEE" points="23,1538.1094,93,1538.1094,93,1545.1094,83,1555.1094,23,1555.1094,23,1538.1094" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="38" y="1551.1763">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="106" x="108" y="1550.3198">[再実行ボタン押下]</text><polygon fill="#A80036" points="316,1577.2422,326,1581.2422,316,1585.2422,320,1581.2422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="57" x2="322" y1="1581.2422" y2="1581.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="64" y="1576.3091">再実行ボタン押下</text><polygon fill="#FBFB77" filter="url(#f15hrlzj7738s9)" points="343,1560.2422,343,1585.2422,611,1585.2422,611,1570.2422,601,1560.2422,343,1560.2422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="601" x2="601" y1="1560.2422" y2="1570.2422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="611" x2="601" y1="1570.2422" y2="1570.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="349" y="1577.3091">スマートカードログインと重複するので略</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="13" x2="799" y1="1602.375" y2="1602.375"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="394" x="18" y="1612.5854">[カード番号とユーザーが紐づいていないまたは、その他装置エラーなど]</text><polygon fill="#A80036" points="349,1633.1797,339,1637.1797,349,1641.1797,345,1637.1797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="343" x2="613" y1="1637.1797" y2="1637.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="355" y="1632.2466">エラーメッセージ表示</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="338" x2="380" y1="1666.4453" y2="1666.4453"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="380" x2="380" y1="1666.4453" y2="1679.4453"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="339" x2="380" y1="1679.4453" y2="1679.4453"/><polygon fill="#A80036" points="349,1675.4453,339,1679.4453,349,1683.4453,345,1679.4453" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="345" y="1661.3794">画面更新</text><polygon fill="#A80036" points="63,1724.5781,53,1728.5781,63,1732.5781,59,1728.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57" x2="332" y1="1728.5781" y2="1728.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="69" y="1723.645">エラーメッセージ表示</text><polygon fill="#FBFB77" filter="url(#f15hrlzj7738s9)" points="343,1692.4453,343,1747.4453,780,1747.4453,780,1702.4453,770,1692.4453,343,1692.4453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="770" x2="770" y1="1692.4453" y2="1702.4453"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="780" x2="770" y1="1702.4453" y2="1702.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="349" y="1709.5122">e.g.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="403" x="349" y="1724.645">スマートカードが登録されていません。管理者に連絡してください。</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="416" x="349" y="1739.7778">カードリーダにエラーがが発生しました。管理者に連絡してください。</text><rect fill="#EEEEEE" filter="url(#f15hrlzj7738s9)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1258.5" x="3" y="1784.4102"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1261.5" y1="1784.4102" y2="1784.4102"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1261.5" y1="1787.4102" y2="1787.4102"/><rect fill="#EEEEEE" filter="url(#f15hrlzj7738s9)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="173" x="545.75" y="1773.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="154" x="551.75" y="1789.9106">スマートカードログイン</text><polygon fill="#A80036" points="316,1828.9766,326,1832.9766,316,1836.9766,320,1832.9766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="57" x2="322" y1="1832.9766" y2="1832.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="64" y="1828.0435">スマートカードログインボタン押下</text><polygon fill="#FBFB77" filter="url(#f15hrlzj7738s9)" points="343,1811.9766,343,1836.9766,481,1836.9766,481,1821.9766,471,1811.9766,343,1811.9766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="471" x2="471" y1="1811.9766" y2="1821.9766"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="481" x2="471" y1="1821.9766" y2="1821.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="349" y="1829.0435">初期画面は認証画面</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="338" x2="380" y1="1867.2422" y2="1867.2422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="380" x2="380" y1="1867.2422" y2="1880.2422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="339" x2="380" y1="1880.2422" y2="1880.2422"/><polygon fill="#A80036" points="349,1876.2422,339,1880.2422,349,1884.2422,345,1880.2422" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="345" y="1862.1763">スマートカードログイン画面遷移</text><polygon fill="#A80036" points="68,1920.2422,58,1924.2422,68,1928.2422,64,1924.2422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="62" x2="327" y1="1924.2422" y2="1924.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="74" y="1904.3091">スマートカードログイン画面</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="74" y="1919.4419">「カードを置いてください」メッセージ</text><polygon fill="#A80036" points="597,1934.5078,607,1938.5078,597,1942.5078,601,1938.5078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="338" x2="603" y1="1938.5078" y2="1938.5078"/><polygon fill="#A80036" points="855,1976.0742,865,1980.0742,855,1984.0742,859,1980.0742" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="619" x2="861" y1="1980.0742" y2="1980.0742"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="626" y="1975.1411">スマートカードログイン要求</text><polygon fill="#FBFB77" filter="url(#f15hrlzj7738s9)" points="882,1951.5078,882,1991.5078,1033,1991.5078,1033,1961.5078,1023,1951.5078,882,1951.5078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1023" x2="1023" y1="1951.5078" y2="1961.5078"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1033" x2="1023" y1="1961.5078" y2="1961.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="888" y="1968.5747">Method: POST</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="888" y="1983.7075">Endpoint: /login/card</text><polygon fill="#A80036" points="1079,2017.7734,1089,2021.7734,1079,2025.7734,1083,2021.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="877" x2="1085" y1="2021.7734" y2="2021.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="884" y="2016.8403">スマートカード番号読み取り命令</text><rect fill="none" height="443.6016" style="stroke: #000000; stroke-width: 2.0;" width="1238.5" x="13" y="2036.9063"/><polygon fill="#EEEEEE" points="13,2036.9063,77,2036.9063,77,2043.9063,67,2053.9063,13,2053.9063,13,2036.9063" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="28" y="2049.9731">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="342" x="92" y="2049.1167">[ユーザーが3秒以内にスマートカードをカードリーダに載せる]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="57" x2="99" y1="2075.1719" y2="2075.1719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="99" x2="99" y1="2075.1719" y2="2088.1719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="58" x2="99" y1="2088.1719" y2="2088.1719"/><polygon fill="#A80036" points="68,2084.1719,58,2088.1719,68,2092.1719,64,2088.1719" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="64" y="2070.106">スマートカードをカードリーダに載せる</text><polygon fill="#A80036" points="888,2113.1719,878,2117.1719,888,2121.1719,884,2117.1719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="882" x2="1095" y1="2117.1719" y2="2117.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="894" y="2112.2388">カード番号検知</text><polygon fill="#A80036" points="1182.5,2142.3047,1192.5,2146.3047,1182.5,2150.3047,1186.5,2146.3047" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="877" x2="1188.5" y1="2146.3047" y2="2146.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="884" y="2141.3716">カード番号からユーザー名/パスワード取得</text><polygon fill="#A80036" points="888,2171.4375,878,2175.4375,888,2179.4375,884,2175.4375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="882" x2="1198.5" y1="2175.4375" y2="2175.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="894" y="2170.5044">ユーザー名/パスワード</text><rect fill="none" height="151.6016" style="stroke: #000000; stroke-width: 2.0;" width="1218.5" x="23" y="2190.5703"/><polygon fill="#EEEEEE" points="23,2190.5703,87,2190.5703,87,2197.5703,77,2207.5703,23,2207.5703,23,2190.5703" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="38" y="2203.6372">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="182" x="102" y="2202.7808">[ユーザー名/パスワード取得成功]</text><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="40.2656" style="stroke: #000000; stroke-width: 2.0;" width="1200.5" x="30" y="2207.7031"/><polygon fill="#EEEEEE" points="30,2207.7031,96,2207.7031,96,2214.7031,86,2224.7031,30,2224.7031,30,2207.7031" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="43" y="2221.77">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="480.75" y="2240.77">ログイン/スマートカードログイン共通シーケンス図</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="1241.5" y1="2253.9688" y2="2253.9688"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="226" x="28" y="2264.1792">[カード番号とユーザーが紐づいていない]</text><polygon fill="#A80036" points="630,2284.7734,620,2288.7734,630,2292.7734,626,2288.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="624" x2="866" y1="2288.7734" y2="2288.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="636" y="2283.8403">失敗応答(401)</text><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="40.2656" style="stroke: #000000; stroke-width: 2.0;" width="624.5" x="30" y="2296.9063"/><polygon fill="#EEEEEE" points="30,2296.9063,96,2296.9063,96,2303.9063,86,2313.9063,30,2313.9063,30,2296.9063" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="43" y="2310.9731">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="259.75" y="2329.9731">スマートカード読み取り失敗</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="13" x2="1251.5" y1="2350.1719" y2="2350.1719"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="354" x="18" y="2360.3823">[ユーザーが3秒以内にスマートカードをカードリーダに載せない]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="877" x2="919" y1="2385.1094" y2="2385.1094"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="919" x2="919" y1="2385.1094" y2="2398.1094"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="878" x2="919" y1="2398.1094" y2="2398.1094"/><polygon fill="#A80036" points="888,2394.1094,878,2398.1094,888,2402.1094,884,2398.1094" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="884" y="2380.0435">タイムアウト判定</text><polygon fill="#A80036" points="625,2423.1094,615,2427.1094,625,2431.1094,621,2427.1094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="619" x2="871" y1="2427.1094" y2="2427.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="631" y="2422.1763">失敗応答(408)</text><rect fill="#FFFFFF" filter="url(#f15hrlzj7738s9)" height="40.2656" style="stroke: #000000; stroke-width: 2.0;" width="624.5" x="30" y="2435.2422"/><polygon fill="#EEEEEE" points="30,2435.2422,96,2435.2422,96,2442.2422,86,2452.2422,30,2452.2422,30,2435.2422" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="43" y="2449.3091">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="259.75" y="2468.3091">スマートカード読み取り失敗</text><rect fill="#EEEEEE" filter="url(#f15hrlzj7738s9)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1258.5" x="3" y="2508.0742"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1261.5" y1="2508.0742" y2="2508.0742"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1261.5" y1="2511.0742" y2="2511.0742"/><rect fill="#EEEEEE" filter="url(#f15hrlzj7738s9)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="89" x="587.75" y="2497.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="70" x="593.75" y="2513.5747">ログアウト</text><polygon fill="#A80036" points="316,2547.6406,326,2551.6406,316,2555.6406,320,2551.6406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="57" x2="322" y1="2551.6406" y2="2551.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="64" y="2546.7075">ログアウトボタン押下</text><polygon fill="#A80036" points="597,2561.7734,607,2565.7734,597,2569.7734,601,2565.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="338" x2="603" y1="2565.7734" y2="2565.7734"/><polygon fill="#A80036" points="855,2605.7734,865,2609.7734,855,2613.7734,859,2609.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="619" x2="861" y1="2609.7734" y2="2609.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="626" y="2589.8403">ログアウト要求</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="626" y="2604.9731">(認証トークン)</text><rect fill="none" height="161.4688" style="stroke: #000000; stroke-width: 2.0;" width="679" x="295" y="2625.0391"/><polygon fill="#EEEEEE" points="295,2625.0391,359,2625.0391,359,2632.0391,349,2642.0391,295,2642.0391,295,2625.0391" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="310" y="2638.106">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="106" x="374" y="2637.2495">[認証トークン有効]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="877" x2="919" y1="2663.3047" y2="2663.3047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="919" x2="919" y1="2663.3047" y2="2676.3047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="878" x2="919" y1="2676.3047" y2="2676.3047"/><polygon fill="#A80036" points="888,2672.3047,878,2676.3047,888,2680.3047,884,2676.3047" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="884" y="2658.2388">トークン破棄</text><polygon fill="#A80036" points="349,2701.3047,339,2705.3047,349,2709.3047,345,2705.3047" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="343" x2="866" y1="2705.3047" y2="2705.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="355" y="2700.3716">ブラウザに保存されているCookieを破棄</text><polygon fill="#A80036" points="630,2730.4375,620,2734.4375,630,2738.4375,626,2734.4375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="624" x2="866" y1="2734.4375" y2="2734.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="636" y="2729.5044">ログアウト成功応答</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="295" x2="974" y1="2743.5703" y2="2743.5703"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="106" x="300" y="2753.7808">[認証トークン無効]</text><polygon fill="#A80036" points="630,2774.375,620,2778.375,630,2782.375,626,2778.375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="624" x2="871" y1="2778.375" y2="2778.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="636" y="2773.4419">トークン無効応答</text><polygon fill="#A80036" points="349,2795.5078,339,2799.5078,349,2803.5078,345,2799.5078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="343" x2="613" y1="2799.5078" y2="2799.5078"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="338" x2="380" y1="2828.6406" y2="2828.6406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="380" x2="380" y1="2828.6406" y2="2841.6406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="339" x2="380" y1="2841.6406" y2="2841.6406"/><polygon fill="#A80036" points="349,2837.6406,339,2841.6406,349,2845.6406,345,2841.6406" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="345" y="2823.5747">ログアウト画面表示</text><polygon fill="#A80036" points="63,2866.6406,53,2870.6406,63,2874.6406,59,2870.6406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57" x2="332" y1="2870.6406" y2="2870.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="69" y="2865.7075">ログアウト画面表示</text><!--
@startuml
title 認証シーケンス(永井作成)
' Participants
actor User as user

box "フロントエンド\nアプリケーション" #ACB9CA
    participant "HTML" as html
    participant "JavaScript" as js
end box

box "バックエンド\nアプリケーション" #B4C6E7
    participant "IdentityManagement" as idm
    participant "PythonScript" as py
end box

box "データベース" #FFE699
    participant "MySQL" as db
end box

'Sequence
== ログイン/スマートカードログイン共通シーケンス図 ==
    activate user
    activate html
    activate js
    activate idm
idm -> idm : ユーザー名/パスワード\nバリデーション
opt バリデーション失敗
    idm - -> js : 失敗応答(401)
end
idm -> db : ユーザー情報取得問合せ
    activate db
db - -> idm : ユーザー情報
    deactivate db
idm -> idm : 認証

alt 認証成功
    idm - -> html : CSRF(クロスサイトリクエストフォージェリ)\n対策のトークンをブラウザのCookieに書き込む
    idm - -> js : ログイン処理応答(ユーザー情報, 201)
    js -> js : ユーザー情報保持
    js -> html :ユーザー情報
    js -> js : 共通画面遷移
    js - -> html : 共通画面表示
    html - -> user : 共通画面表示
else 認証失敗
    idm - -> js : ログイン処理応答(401)
        deactivate idm
    js - -> html : エラーメッセージ
      deactivate js
    html -> html : エラーメッセージ表示
    html - -> user : ログイン失敗
        deactivate html
        deactivate user
end


== ログイン ==
user -> html : ユーザー名入力
    note right : 初期画面は認証画面
    activate user
    activate html
user -> html : パスワード入力
user -> html : ログインボタン押下
html -> js :ユーザー名/パスワード
    activate js
js -> js : ユーザー名/パスワード\nバリデーション
opt バリデーション失敗
    js - -> html : エラーメッセージ
    html -> html : エラーメッセージ表示
    html - -> user : ログイン失敗
end
js -> idm : ログイン処理要求\n(ユーザー名/パスワード)
    note right : Method: POST\nEndpoint: /login
    activate idm
    deactivate html
    deactivate user
    deactivate idm
    deactivate js
ref over user, db : ログイン/スマートカードログイン共通シーケンス図


== スマートカード読み取り失敗 ==
js -> js : 失敗原因確認
    activate user
    activate html
    activate js

note right : バックエンドからの応答のBodyで判断する
alt ユーザーが3秒以内にスマートカードをカードリーダに載せない
    js - -> html : エラーメッセージおよび再実行ボタン表示
    html -> html : 画面更新
    html - -> user : エラーメッセージおよび再実行ボタン表示
    note right : スマートカード読み取りに失敗しました。\n再度スマートカード読み取りしますか?
    opt 再実行ボタン押下
        user -> html : 再実行ボタン押下
        note right : スマートカードログインと重複するので略
    end
else カード番号とユーザーが紐づいていないまたは、その他装置エラーなど
    js - -> html : エラーメッセージ表示
        deactivate js
    html -> html : 画面更新
    html - -> user : エラーメッセージ表示
        deactivate html
        deactivate user
    note right : e.g.\nスマートカードが登録されていません。管理者に連絡してください。\nカードリーダにエラーがが発生しました。管理者に連絡してください。
end

== スマートカードログイン ==
user -> html : スマートカードログインボタン押下
    activate user
    activate html
    note right : 初期画面は認証画面
html -> html : スマートカードログイン画面遷移
html -> user : スマートカードログイン画面\n「カードを置いてください」メッセージ
html -> js :
    activate js
js -> idm : スマートカードログイン要求
    note right : Method: POST\nEndpoint: /login/card
    activate idm
idm -> py : スマートカード番号読み取り命令
    activate py
alt ユーザーが3秒以内にスマートカードをカードリーダに載せる
    user -> user : スマートカードをカードリーダに載せる
    py - -> idm : カード番号検知
        deactivate py
    idm -> db : カード番号からユーザー名/パスワード取得
        activate db
    db - -> idm : ユーザー名/パスワード
        deactivate db
    alt ユーザー名/パスワード取得成功
        ref over user, db : ログイン/スマートカードログイン共通シーケンス図
    else カード番号とユーザーが紐づいていない
        idm - -> js : 失敗応答(401)
        ref over user, js : スマートカード読み取り失敗
    end
else ユーザーが3秒以内にスマートカードをカードリーダに載せない
    idm -> idm : タイムアウト判定

    idm - -> js : 失敗応答(408)
    deactivate js
    deactivate html
    deactivate user
    deactivate idm
    ref over user, js : スマートカード読み取り失敗
end


== ログアウト ==
user -> html : ログアウトボタン押下
    activate user
    activate html
html -> js :
    activate js
js -> idm : ログアウト要求\n(認証トークン)
    activate idm
alt 認証トークン有効
    idm -> idm : トークン破棄
    idm -> html : ブラウザに保存されているCookieを破棄
    idm - -> js : ログアウト成功応答
else 認証トークン無効
    idm - -> js : トークン無効応答
        deactivate idm
end
js -> html :
    deactivate js
html -> html : ログアウト画面表示
html - -> user : ログアウト画面表示
    deactivate html
    deactivate user
@enduml

PlantUML version 1.2017.19beta12(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>